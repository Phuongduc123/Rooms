{"version":3,"file":"react-easy-crop.js","sources":["../../src/helpers.ts","../../src/index.tsx"],"sourcesContent":["import { Area, MediaSize, Point, Size } from './types'\n\n/**\n * Compute the dimension of the crop area based on media size,\n * aspect ratio and optionally rotation\n */\nexport function getCropSize(\n  mediaWidth: number,\n  mediaHeight: number,\n  containerWidth: number,\n  containerHeight: number,\n  aspect: number,\n  rotation = 0\n): Size {\n  const { width, height } = translateSize(mediaWidth, mediaHeight, rotation)\n  const fittingWidth = Math.min(width, containerWidth)\n  const fittingHeight = Math.min(height, containerHeight)\n\n  if (fittingWidth > fittingHeight * aspect) {\n    return {\n      width: fittingHeight * aspect,\n      height: fittingHeight,\n    }\n  }\n\n  return {\n    width: fittingWidth,\n    height: fittingWidth / aspect,\n  }\n}\n\n/**\n * Ensure a new media position stays in the crop area.\n */\nexport function restrictPosition(\n  position: Point,\n  mediaSize: Size,\n  cropSize: Size,\n  zoom: number,\n  rotation = 0\n): Point {\n  const { width, height } = translateSize(mediaSize.width, mediaSize.height, rotation)\n\n  return {\n    x: restrictPositionCoord(position.x, width, cropSize.width, zoom),\n    y: restrictPositionCoord(position.y, height, cropSize.height, zoom),\n  }\n}\n\nfunction restrictPositionCoord(\n  position: number,\n  mediaSize: number,\n  cropSize: number,\n  zoom: number\n): number {\n  const maxPosition = (mediaSize * zoom) / 2 - cropSize / 2\n  return Math.min(maxPosition, Math.max(position, -maxPosition))\n}\n\nexport function getDistanceBetweenPoints(pointA: Point, pointB: Point) {\n  return Math.sqrt(Math.pow(pointA.y - pointB.y, 2) + Math.pow(pointA.x - pointB.x, 2))\n}\n\nexport function getRotationBetweenPoints(pointA: Point, pointB: Point) {\n  return (Math.atan2(pointB.y - pointA.y, pointB.x - pointA.x) * 180) / Math.PI\n}\n\n/**\n * Compute the output cropped area of the media in percentages and pixels.\n * x/y are the top-left coordinates on the src media\n */\nexport function computeCroppedArea(\n  crop: Point,\n  mediaSize: MediaSize,\n  cropSize: Size,\n  aspect: number,\n  zoom: number,\n  rotation = 0,\n  restrictPosition = true\n): { croppedAreaPercentages: Area; croppedAreaPixels: Area } {\n  // if the media is rotated by the user, we cannot limit the position anymore\n  // as it might need to be negative.\n  const limitAreaFn = restrictPosition && rotation === 0 ? limitArea : noOp\n  const croppedAreaPercentages = {\n    x: limitAreaFn(\n      100,\n      (((mediaSize.width - cropSize.width / zoom) / 2 - crop.x / zoom) / mediaSize.width) * 100\n    ),\n    y: limitAreaFn(\n      100,\n      (((mediaSize.height - cropSize.height / zoom) / 2 - crop.y / zoom) / mediaSize.height) * 100\n    ),\n    width: limitAreaFn(100, ((cropSize.width / mediaSize.width) * 100) / zoom),\n    height: limitAreaFn(100, ((cropSize.height / mediaSize.height) * 100) / zoom),\n  }\n\n  // we compute the pixels size naively\n  const widthInPixels = Math.round(\n    limitAreaFn(\n      mediaSize.naturalWidth,\n      (croppedAreaPercentages.width * mediaSize.naturalWidth) / 100\n    )\n  )\n  const heightInPixels = Math.round(\n    limitAreaFn(\n      mediaSize.naturalHeight,\n      (croppedAreaPercentages.height * mediaSize.naturalHeight) / 100\n    )\n  )\n  const isImgWiderThanHigh = mediaSize.naturalWidth >= mediaSize.naturalHeight * aspect\n\n  // then we ensure the width and height exactly match the aspect (to avoid rounding approximations)\n  // if the media is wider than high, when zoom is 0, the crop height will be equals to iamge height\n  // thus we want to compute the width from the height and aspect for accuracy.\n  // Otherwise, we compute the height from width and aspect.\n  const sizePixels = isImgWiderThanHigh\n    ? {\n        width: Math.round(heightInPixels * aspect),\n        height: heightInPixels,\n      }\n    : {\n        width: widthInPixels,\n        height: Math.round(widthInPixels / aspect),\n      }\n  const croppedAreaPixels = {\n    ...sizePixels,\n    x: Math.round(\n      limitAreaFn(\n        mediaSize.naturalWidth - sizePixels.width,\n        (croppedAreaPercentages.x * mediaSize.naturalWidth) / 100\n      )\n    ),\n    y: Math.round(\n      limitAreaFn(\n        mediaSize.naturalHeight - sizePixels.height,\n        (croppedAreaPercentages.y * mediaSize.naturalHeight) / 100\n      )\n    ),\n  }\n  return { croppedAreaPercentages, croppedAreaPixels }\n}\n\n/**\n * Ensure the returned value is between 0 and max\n */\nfunction limitArea(max: number, value: number): number {\n  return Math.min(max, Math.max(0, value))\n}\n\nfunction noOp(_max: number, value: number) {\n  return value\n}\n\n/**\n * Compute the crop and zoom from the croppedAreaPixels\n */\nfunction getZoomFromCroppedAreaPixels(\n  croppedAreaPixels: Area,\n  mediaSize: MediaSize,\n  cropSize?: Size\n): number {\n  const mediaZoom = mediaSize.width / mediaSize.naturalWidth\n\n  if (cropSize) {\n    const isHeightMaxSize = cropSize.height > cropSize.width\n    return isHeightMaxSize\n      ? cropSize.height / mediaZoom / croppedAreaPixels.height\n      : cropSize.width / mediaZoom / croppedAreaPixels.width\n  }\n\n  const aspect = croppedAreaPixels.width / croppedAreaPixels.height\n  const isHeightMaxSize = mediaSize.naturalWidth >= mediaSize.naturalHeight * aspect\n  return isHeightMaxSize\n    ? mediaSize.naturalHeight / croppedAreaPixels.height\n    : mediaSize.naturalWidth / croppedAreaPixels.width\n}\n\n/**\n * Compute the crop and zoom from the croppedAreaPixels\n */\nexport function getInitialCropFromCroppedAreaPixels(\n  croppedAreaPixels: Area,\n  mediaSize: MediaSize,\n  cropSize?: Size\n): { crop: Point; zoom: number } {\n  const mediaZoom = mediaSize.width / mediaSize.naturalWidth\n\n  const zoom = getZoomFromCroppedAreaPixels(croppedAreaPixels, mediaSize, cropSize)\n\n  const cropZoom = mediaZoom * zoom\n\n  const crop = {\n    x: ((mediaSize.naturalWidth - croppedAreaPixels.width) / 2 - croppedAreaPixels.x) * cropZoom,\n    y: ((mediaSize.naturalHeight - croppedAreaPixels.height) / 2 - croppedAreaPixels.y) * cropZoom,\n  }\n  return { crop, zoom }\n}\n\n/**\n * Return the point that is the center of point a and b\n */\nexport function getCenter(a: Point, b: Point): Point {\n  return {\n    x: (b.x + a.x) / 2,\n    y: (b.y + a.y) / 2,\n  }\n}\n\n/**\n *\n * Returns an x,y point once rotated around xMid,yMid\n */\nexport function rotateAroundMidPoint(\n  x: number,\n  y: number,\n  xMid: number,\n  yMid: number,\n  degrees: number\n): [number, number] {\n  const cos = Math.cos\n  const sin = Math.sin\n  const radian = (degrees * Math.PI) / 180 // Convert to radians\n  // Subtract midpoints, so that midpoint is translated to origin\n  // and add it in the end again\n  const xr = (x - xMid) * cos(radian) - (y - yMid) * sin(radian) + xMid\n  const yr = (x - xMid) * sin(radian) + (y - yMid) * cos(radian) + yMid\n\n  return [xr, yr]\n}\n\n/**\n * Returns the new bounding area of a rotated rectangle.\n */\nexport function translateSize(width: number, height: number, rotation: number): Size {\n  const centerX = width / 2\n  const centerY = height / 2\n\n  const outerBounds = [\n    rotateAroundMidPoint(0, 0, centerX, centerY, rotation),\n    rotateAroundMidPoint(width, 0, centerX, centerY, rotation),\n    rotateAroundMidPoint(width, height, centerX, centerY, rotation),\n    rotateAroundMidPoint(0, height, centerX, centerY, rotation),\n  ]\n\n  const minX = Math.min(...outerBounds.map(p => p[0]))\n  const maxX = Math.max(...outerBounds.map(p => p[0]))\n  const minY = Math.min(...outerBounds.map(p => p[1]))\n  const maxY = Math.max(...outerBounds.map(p => p[1]))\n\n  return { width: maxX - minX, height: maxY - minY }\n}\n\n/**\n * Combine multiple class names into a single string.\n */\nexport function classNames(...args: (boolean | string | number | undefined | void | null)[]) {\n  return args\n    .filter(value => {\n      if (typeof value === 'string' && value.length > 0) {\n        return true\n      }\n\n      return false\n    })\n    .join(' ')\n    .trim()\n}\n","import React from 'react'\nimport normalizeWheel from 'normalize-wheel'\nimport { Area, MediaSize, Point, Size } from './types'\nimport {\n  getCropSize,\n  restrictPosition,\n  getDistanceBetweenPoints,\n  getRotationBetweenPoints,\n  computeCroppedArea,\n  getCenter,\n  getInitialCropFromCroppedAreaPixels,\n  classNames,\n} from './helpers'\nimport cssStyles from './styles.css'\n\nexport type CropperProps = {\n  image?: string\n  video?: string\n  transform?: string\n  crop: Point\n  zoom: number\n  rotation: number\n  aspect: number\n  minZoom: number\n  maxZoom: number\n  cropShape: 'rect' | 'round'\n  cropSize?: Size\n  showGrid?: boolean\n  zoomSpeed: number\n  zoomWithScroll?: boolean\n  onCropChange: (location: Point) => void\n  onZoomChange?: (zoom: number) => void\n  onRotationChange?: (rotation: number) => void\n  onCropComplete?: (croppedArea: Area, croppedAreaPixels: Area) => void\n  onCropAreaChange?: (croppedArea: Area, croppedAreaPixels: Area) => void\n  onCropSizeChange?: (cropSize: Size) => void\n  onInteractionStart?: () => void\n  onInteractionEnd?: () => void\n  onMediaLoaded?: (mediaSize: MediaSize) => void\n  style: {\n    containerStyle?: React.CSSProperties\n    mediaStyle?: React.CSSProperties\n    cropAreaStyle?: React.CSSProperties\n  }\n  classes: {\n    containerClassName?: string\n    mediaClassName?: string\n    cropAreaClassName?: string\n  }\n  restrictPosition: boolean\n  initialCroppedAreaPixels?: Area\n  mediaProps: React.ImgHTMLAttributes<HTMLElement> | React.VideoHTMLAttributes<HTMLElement>\n  disableAutomaticStylesInjection?: boolean\n}\n\ntype State = {\n  cropSize: Size | null\n  hasWheelJustStarted: boolean\n}\n\nconst MIN_ZOOM = 1\nconst MAX_ZOOM = 3\n\nclass Cropper extends React.Component<CropperProps, State> {\n  static defaultProps = {\n    zoom: 1,\n    rotation: 0,\n    aspect: 4 / 3,\n    maxZoom: MAX_ZOOM,\n    minZoom: MIN_ZOOM,\n    cropShape: 'rect',\n    showGrid: true,\n    style: {},\n    classes: {},\n    mediaProps: {},\n    zoomSpeed: 1,\n    restrictPosition: true,\n    zoomWithScroll: true,\n  }\n\n  imageRef: HTMLImageElement | null = null\n  videoRef: HTMLVideoElement | null = null\n  containerRef: HTMLDivElement | null = null\n  styleRef: HTMLStyleElement | null = null\n  containerRect: DOMRect | null = null\n  mediaSize: MediaSize = { width: 0, height: 0, naturalWidth: 0, naturalHeight: 0 }\n  dragStartPosition: Point = { x: 0, y: 0 }\n  dragStartCrop: Point = { x: 0, y: 0 }\n  lastPinchDistance = 0\n  lastPinchRotation = 0\n  rafDragTimeout: number | null = null\n  rafPinchTimeout: number | null = null\n  wheelTimer: number | null = null\n\n  state: State = {\n    cropSize: null,\n    hasWheelJustStarted: false,\n  }\n\n  componentDidMount() {\n    window.addEventListener('resize', this.computeSizes)\n    if (this.containerRef) {\n      this.props.zoomWithScroll &&\n        this.containerRef.addEventListener('wheel', this.onWheel, { passive: false })\n      this.containerRef.addEventListener('gesturestart', this.preventZoomSafari)\n      this.containerRef.addEventListener('gesturechange', this.preventZoomSafari)\n    }\n\n    if (!this.props.disableAutomaticStylesInjection) {\n      this.styleRef = document.createElement('style')\n      this.styleRef.setAttribute('type', 'text/css')\n      this.styleRef.innerHTML = cssStyles\n      document.head.appendChild(this.styleRef)\n    }\n\n    // when rendered via SSR, the image can already be loaded and its onLoad callback will never be called\n    if (this.imageRef && this.imageRef.complete) {\n      this.onMediaLoad()\n    }\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('resize', this.computeSizes)\n    if (this.containerRef) {\n      this.containerRef.removeEventListener('gesturestart', this.preventZoomSafari)\n      this.containerRef.removeEventListener('gesturechange', this.preventZoomSafari)\n    }\n\n    if (this.styleRef) {\n      this.styleRef.remove()\n    }\n\n    this.cleanEvents()\n    this.props.zoomWithScroll && this.clearScrollEvent()\n  }\n\n  componentDidUpdate(prevProps: CropperProps) {\n    if (prevProps.rotation !== this.props.rotation) {\n      this.computeSizes()\n      this.recomputeCropPosition()\n    } else if (prevProps.aspect !== this.props.aspect) {\n      this.computeSizes()\n    } else if (prevProps.zoom !== this.props.zoom) {\n      this.recomputeCropPosition()\n    } else if (\n      prevProps.cropSize?.height !== this.props.cropSize?.height ||\n      prevProps.cropSize?.width !== this.props.cropSize?.width\n    ) {\n      this.computeSizes()\n    } else if (\n      prevProps.crop?.x !== this.props.crop?.x ||\n      prevProps.crop?.y !== this.props.crop?.y\n    ) {\n      this.emitCropAreaChange()\n    }\n    if (prevProps.zoomWithScroll !== this.props.zoomWithScroll && this.containerRef) {\n      this.props.zoomWithScroll\n        ? this.containerRef.addEventListener('wheel', this.onWheel, { passive: false })\n        : this.clearScrollEvent()\n    }\n  }\n\n  // this is to prevent Safari on iOS >= 10 to zoom the page\n  preventZoomSafari = (e: Event) => e.preventDefault()\n\n  cleanEvents = () => {\n    document.removeEventListener('mousemove', this.onMouseMove)\n    document.removeEventListener('mouseup', this.onDragStopped)\n    document.removeEventListener('touchmove', this.onTouchMove)\n    document.removeEventListener('touchend', this.onDragStopped)\n  }\n\n  clearScrollEvent = () => {\n    if (this.containerRef) this.containerRef.removeEventListener('wheel', this.onWheel)\n    if (this.wheelTimer) {\n      clearTimeout(this.wheelTimer)\n    }\n  }\n\n  onMediaLoad = () => {\n    this.computeSizes()\n    this.emitCropData()\n    this.setInitialCrop()\n\n    if (this.props.onMediaLoaded) {\n      this.props.onMediaLoaded(this.mediaSize)\n    }\n  }\n\n  setInitialCrop = () => {\n    const { initialCroppedAreaPixels, cropSize } = this.props\n\n    if (!initialCroppedAreaPixels) {\n      return\n    }\n\n    const { crop, zoom } = getInitialCropFromCroppedAreaPixels(\n      initialCroppedAreaPixels,\n      this.mediaSize,\n      cropSize\n    )\n    this.props.onCropChange(crop)\n    this.props.onZoomChange && this.props.onZoomChange(zoom)\n  }\n\n  getAspect() {\n    const { cropSize, aspect } = this.props\n    if (cropSize) {\n      return cropSize.width / cropSize.height\n    }\n    return aspect\n  }\n\n  computeSizes = () => {\n    const mediaRef = this.imageRef || this.videoRef\n    if (mediaRef && this.containerRef) {\n      this.containerRect = this.containerRef.getBoundingClientRect()\n\n      this.mediaSize = {\n        width: mediaRef.offsetWidth,\n        height: mediaRef.offsetHeight,\n        naturalWidth: this.imageRef?.naturalWidth || this.videoRef?.videoWidth || 0,\n        naturalHeight: this.imageRef?.naturalHeight || this.videoRef?.videoHeight || 0,\n      }\n      const cropSize = this.props.cropSize\n        ? this.props.cropSize\n        : getCropSize(\n            mediaRef.offsetWidth,\n            mediaRef.offsetHeight,\n            this.containerRect.width,\n            this.containerRect.height,\n            this.props.aspect,\n            this.props.rotation\n          )\n\n      if (\n        this.state.cropSize?.height !== cropSize.height ||\n        this.state.cropSize?.width !== cropSize.width\n      ) {\n        this.props.onCropSizeChange && this.props.onCropSizeChange(cropSize)\n      }\n      this.setState({ cropSize }, this.recomputeCropPosition)\n    }\n  }\n\n  static getMousePoint = (e: MouseEvent | React.MouseEvent) => ({\n    x: Number(e.clientX),\n    y: Number(e.clientY),\n  })\n\n  static getTouchPoint = (touch: Touch | React.Touch) => ({\n    x: Number(touch.clientX),\n    y: Number(touch.clientY),\n  })\n\n  onMouseDown = (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    e.preventDefault()\n    document.addEventListener('mousemove', this.onMouseMove)\n    document.addEventListener('mouseup', this.onDragStopped)\n    this.onDragStart(Cropper.getMousePoint(e))\n  }\n\n  onMouseMove = (e: MouseEvent) => this.onDrag(Cropper.getMousePoint(e))\n\n  onTouchStart = (e: React.TouchEvent<HTMLDivElement>) => {\n    e.preventDefault()\n    document.addEventListener('touchmove', this.onTouchMove, { passive: false }) // iOS 11 now defaults to passive: true\n    document.addEventListener('touchend', this.onDragStopped)\n    if (e.touches.length === 2) {\n      this.onPinchStart(e)\n    } else if (e.touches.length === 1) {\n      this.onDragStart(Cropper.getTouchPoint(e.touches[0]))\n    }\n  }\n\n  onTouchMove = (e: TouchEvent) => {\n    // Prevent whole page from scrolling on iOS.\n    e.preventDefault()\n    if (e.touches.length === 2) {\n      this.onPinchMove(e)\n    } else if (e.touches.length === 1) {\n      this.onDrag(Cropper.getTouchPoint(e.touches[0]))\n    }\n  }\n\n  onDragStart = ({ x, y }: Point) => {\n    this.dragStartPosition = { x, y }\n    this.dragStartCrop = { ...this.props.crop }\n    this.props.onInteractionStart?.()\n  }\n\n  onDrag = ({ x, y }: Point) => {\n    if (this.rafDragTimeout) window.cancelAnimationFrame(this.rafDragTimeout)\n\n    this.rafDragTimeout = window.requestAnimationFrame(() => {\n      if (!this.state.cropSize) return\n      if (x === undefined || y === undefined) return\n      const offsetX = x - this.dragStartPosition.x\n      const offsetY = y - this.dragStartPosition.y\n      const requestedPosition = {\n        x: this.dragStartCrop.x + offsetX,\n        y: this.dragStartCrop.y + offsetY,\n      }\n\n      const newPosition = this.props.restrictPosition\n        ? restrictPosition(\n            requestedPosition,\n            this.mediaSize,\n            this.state.cropSize,\n            this.props.zoom,\n            this.props.rotation\n          )\n        : requestedPosition\n      this.props.onCropChange(newPosition)\n    })\n  }\n\n  onDragStopped = () => {\n    this.cleanEvents()\n    this.emitCropData()\n    this.props.onInteractionEnd?.()\n  }\n\n  onPinchStart(e: React.TouchEvent<HTMLDivElement>) {\n    const pointA = Cropper.getTouchPoint(e.touches[0])\n    const pointB = Cropper.getTouchPoint(e.touches[1])\n    this.lastPinchDistance = getDistanceBetweenPoints(pointA, pointB)\n    this.lastPinchRotation = getRotationBetweenPoints(pointA, pointB)\n    this.onDragStart(getCenter(pointA, pointB))\n  }\n\n  onPinchMove(e: TouchEvent) {\n    const pointA = Cropper.getTouchPoint(e.touches[0])\n    const pointB = Cropper.getTouchPoint(e.touches[1])\n    const center = getCenter(pointA, pointB)\n    this.onDrag(center)\n\n    if (this.rafPinchTimeout) window.cancelAnimationFrame(this.rafPinchTimeout)\n    this.rafPinchTimeout = window.requestAnimationFrame(() => {\n      const distance = getDistanceBetweenPoints(pointA, pointB)\n      const newZoom = this.props.zoom * (distance / this.lastPinchDistance)\n      this.setNewZoom(newZoom, center)\n      this.lastPinchDistance = distance\n\n      const rotation = getRotationBetweenPoints(pointA, pointB)\n      const newRotation = this.props.rotation + (rotation - this.lastPinchRotation)\n      this.props.onRotationChange && this.props.onRotationChange(newRotation)\n      this.lastPinchRotation = rotation\n    })\n  }\n\n  onWheel = (e: WheelEvent) => {\n    e.preventDefault()\n    const point = Cropper.getMousePoint(e)\n    const { pixelY } = normalizeWheel(e)\n    const newZoom = this.props.zoom - (pixelY * this.props.zoomSpeed) / 200\n    this.setNewZoom(newZoom, point)\n\n    if (!this.state.hasWheelJustStarted) {\n      this.setState({ hasWheelJustStarted: true }, () => this.props.onInteractionStart?.())\n    }\n\n    if (this.wheelTimer) {\n      clearTimeout(this.wheelTimer)\n    }\n    this.wheelTimer = window.setTimeout(\n      () => this.setState({ hasWheelJustStarted: false }, () => this.props.onInteractionEnd?.()),\n      250\n    )\n  }\n\n  getPointOnContainer = ({ x, y }: Point) => {\n    if (!this.containerRect) {\n      throw new Error('The Cropper is not mounted')\n    }\n    return {\n      x: this.containerRect.width / 2 - (x - this.containerRect.left),\n      y: this.containerRect.height / 2 - (y - this.containerRect.top),\n    }\n  }\n\n  getPointOnMedia = ({ x, y }: Point) => {\n    const { crop, zoom } = this.props\n    return {\n      x: (x + crop.x) / zoom,\n      y: (y + crop.y) / zoom,\n    }\n  }\n\n  setNewZoom = (zoom: number, point: Point) => {\n    if (!this.state.cropSize || !this.props.onZoomChange) return\n\n    const zoomPoint = this.getPointOnContainer(point)\n    const zoomTarget = this.getPointOnMedia(zoomPoint)\n    const newZoom = Math.min(this.props.maxZoom, Math.max(zoom, this.props.minZoom))\n    const requestedPosition = {\n      x: zoomTarget.x * newZoom - zoomPoint.x,\n      y: zoomTarget.y * newZoom - zoomPoint.y,\n    }\n    const newPosition = this.props.restrictPosition\n      ? restrictPosition(\n          requestedPosition,\n          this.mediaSize,\n          this.state.cropSize,\n          newZoom,\n          this.props.rotation\n        )\n      : requestedPosition\n\n    this.props.onCropChange(newPosition)\n    this.props.onZoomChange(newZoom)\n  }\n\n  getCropData = () => {\n    if (!this.state.cropSize) {\n      return null\n    }\n\n    // this is to ensure the crop is correctly restricted after a zoom back (https://github.com/ricardo-ch/react-easy-crop/issues/6)\n    const restrictedPosition = this.props.restrictPosition\n      ? restrictPosition(\n          this.props.crop,\n          this.mediaSize,\n          this.state.cropSize,\n          this.props.zoom,\n          this.props.rotation\n        )\n      : this.props.crop\n    return computeCroppedArea(\n      restrictedPosition,\n      this.mediaSize,\n      this.state.cropSize,\n      this.getAspect(),\n      this.props.zoom,\n      this.props.rotation,\n      this.props.restrictPosition\n    )\n  }\n\n  emitCropData = () => {\n    const cropData = this.getCropData()\n    if (!cropData) return\n\n    const { croppedAreaPercentages, croppedAreaPixels } = cropData\n    if (this.props.onCropComplete) {\n      this.props.onCropComplete(croppedAreaPercentages, croppedAreaPixels)\n    }\n\n    if (this.props.onCropAreaChange) {\n      this.props.onCropAreaChange(croppedAreaPercentages, croppedAreaPixels)\n    }\n  }\n\n  emitCropAreaChange = () => {\n    const cropData = this.getCropData()\n    if (!cropData) return\n\n    const { croppedAreaPercentages, croppedAreaPixels } = cropData\n    if (this.props.onCropAreaChange) {\n      this.props.onCropAreaChange(croppedAreaPercentages, croppedAreaPixels)\n    }\n  }\n\n  recomputeCropPosition = () => {\n    if (!this.state.cropSize) return\n\n    const newPosition = this.props.restrictPosition\n      ? restrictPosition(\n          this.props.crop,\n          this.mediaSize,\n          this.state.cropSize,\n          this.props.zoom,\n          this.props.rotation\n        )\n      : this.props.crop\n    this.props.onCropChange(newPosition)\n    this.emitCropData()\n  }\n\n  render() {\n    const {\n      image,\n      video,\n      mediaProps,\n      transform,\n      crop: { x, y },\n      rotation,\n      zoom,\n      cropShape,\n      showGrid,\n      style: { containerStyle, cropAreaStyle, mediaStyle },\n      classes: { containerClassName, cropAreaClassName, mediaClassName },\n    } = this.props\n\n    return (\n      <div\n        onMouseDown={this.onMouseDown}\n        onTouchStart={this.onTouchStart}\n        ref={(el) => (this.containerRef = el)}\n        data-testid=\"container\"\n        style={containerStyle}\n        className={classNames('reactEasyCrop_Container', containerClassName)}\n      >\n        {image ? (\n          <img\n            alt=\"\"\n            className={classNames('reactEasyCrop_Image', mediaClassName)}\n            {...(mediaProps as React.ImgHTMLAttributes<HTMLElement>)}\n            src={image}\n            ref={(el: HTMLImageElement) => (this.imageRef = el)}\n            style={{\n              ...mediaStyle,\n              transform:\n                transform || `translate(${x}px, ${y}px) rotate(${rotation}deg) scale(${zoom})`,\n            }}\n            onLoad={this.onMediaLoad}\n          />\n        ) : (\n          video && (\n            <video\n              autoPlay\n              loop\n              muted={true}\n              className={classNames('reactEasyCrop_Video', mediaClassName)}\n              {...mediaProps}\n              src={video}\n              ref={(el: HTMLVideoElement) => (this.videoRef = el)}\n              onLoadedMetadata={this.onMediaLoad}\n              style={{\n                ...mediaStyle,\n                transform:\n                  transform || `translate(${x}px, ${y}px) rotate(${rotation}deg) scale(${zoom})`,\n              }}\n              controls={false}\n            />\n          )\n        )}\n        {this.state.cropSize && (\n          <div\n            style={{\n              ...cropAreaStyle,\n              width: this.state.cropSize.width,\n              height: this.state.cropSize.height,\n            }}\n            data-testid=\"cropper\"\n            className={classNames(\n              'reactEasyCrop_CropArea',\n              cropShape === 'round' && 'reactEasyCrop_CropAreaRound',\n              showGrid && 'reactEasyCrop_CropAreaGrid',\n              cropAreaClassName\n            )}\n          />\n        )}\n      </div>\n    )\n  }\n}\n\nexport default Cropper\n"],"names":["getCropSize","mediaWidth","mediaHeight","containerWidth","containerHeight","aspect","rotation","_a","translateSize","width","height","fittingWidth","Math","min","fittingHeight","restrictPosition","position","mediaSize","cropSize","zoom","x","restrictPositionCoord","y","maxPosition","max","getDistanceBetweenPoints","pointA","pointB","sqrt","pow","getRotationBetweenPoints","atan2","PI","computeCroppedArea","crop","limitAreaFn","limitArea","noOp","croppedAreaPercentages","widthInPixels","round","naturalWidth","heightInPixels","naturalHeight","isImgWiderThanHigh","sizePixels","croppedAreaPixels","value","_max","getZoomFromCroppedAreaPixels","mediaZoom","isHeightMaxSize_1","isHeightMaxSize","getInitialCropFromCroppedAreaPixels","cropZoom","getCenter","a","b","rotateAroundMidPoint","xMid","yMid","degrees","cos","sin","radian","xr","yr","centerX","centerY","outerBounds","minX","map","p","maxX","minY","maxY","classNames","_i","args","filter","length","join","trim","MIN_ZOOM","MAX_ZOOM","__extends","_this","hasWheelJustStarted","e","preventDefault","document","removeEventListener","onMouseMove","onDragStopped","onTouchMove","containerRef","onWheel","wheelTimer","clearTimeout","computeSizes","emitCropData","setInitialCrop","props","onMediaLoaded","initialCroppedAreaPixels","_b","onCropChange","onZoomChange","mediaRef","imageRef","videoRef","containerRect","getBoundingClientRect","offsetWidth","offsetHeight","videoWidth","videoHeight","state","onCropSizeChange","setState","recomputeCropPosition","addEventListener","onDragStart","Cropper","getMousePoint","onDrag","passive","touches","onPinchStart","getTouchPoint","onPinchMove","dragStartPosition","dragStartCrop","onInteractionStart","rafDragTimeout","window","cancelAnimationFrame","requestAnimationFrame","undefined","offsetX","offsetY","requestedPosition","newPosition","cleanEvents","onInteractionEnd","point","pixelY","normalizeWheel","newZoom","zoomSpeed","setNewZoom","setTimeout","Error","left","top","zoomPoint","getPointOnContainer","zoomTarget","getPointOnMedia","maxZoom","minZoom","restrictedPosition","getAspect","cropData","getCropData","onCropComplete","onCropAreaChange","zoomWithScroll","preventZoomSafari","disableAutomaticStylesInjection","styleRef","createElement","setAttribute","innerHTML","cssStyles","head","appendChild","complete","onMediaLoad","remove","clearScrollEvent","prevProps","emitCropAreaChange","lastPinchDistance","lastPinchRotation","center","rafPinchTimeout","distance","newRotation","onRotationChange","image","video","mediaProps","transform","cropShape","showGrid","_c","containerStyle","cropAreaStyle","mediaStyle","_d","containerClassName","cropAreaClassName","mediaClassName","React","onMouseDown","onTouchStart","ref","el","style","className","alt","src","onLoad","autoPlay","loop","muted","onLoadedMetadata","controls","classes","Number","clientX","clientY","touch","Component"],"mappings":";;;;;;;;;;;EAEA;;;;;WAIgBA,YACdC,YACAC,aACAC,gBACAC,iBACAC,QACAC;EAAA,yBAAA,EAAA;EAAAA,IAAAA,YAAA;;;EAEM,MAAAC,KAAoBC,aAAa,CAACP,UAAD,EAAaC,WAAb,EAA0BI,QAA1B,CAAjC;EAAA,MAAEG,KAAK,WAAP;EAAA,MAASC,MAAM,YAAf;;EACN,MAAMC,YAAY,GAAGC,IAAI,CAACC,GAAL,CAASJ,KAAT,EAAgBN,cAAhB,CAArB;EACA,MAAMW,aAAa,GAAGF,IAAI,CAACC,GAAL,CAASH,MAAT,EAAiBN,eAAjB,CAAtB;;EAEA,MAAIO,YAAY,GAAGG,aAAa,GAAGT,MAAnC,EAA2C;EACzC,WAAO;EACLI,MAAAA,KAAK,EAAEK,aAAa,GAAGT,MADlB;EAELK,MAAAA,MAAM,EAAEI;EAFH,KAAP;EAID;;EAED,SAAO;EACLL,IAAAA,KAAK,EAAEE,YADF;EAELD,IAAAA,MAAM,EAAEC,YAAY,GAAGN;EAFlB,GAAP;EAID;EAED;;;;WAGgBU,iBACdC,UACAC,WACAC,UACAC,MACAb;EAAA,yBAAA,EAAA;EAAAA,IAAAA,YAAA;;;EAEM,MAAAC,KAAoBC,aAAa,CAACS,SAAS,CAACR,KAAX,EAAkBQ,SAAS,CAACP,MAA5B,EAAoCJ,QAApC,CAAjC;EAAA,MAAEG,KAAK,WAAP;EAAA,MAASC,MAAM,YAAf;;EAEN,SAAO;EACLU,IAAAA,CAAC,EAAEC,qBAAqB,CAACL,QAAQ,CAACI,CAAV,EAAaX,KAAb,EAAoBS,QAAQ,CAACT,KAA7B,EAAoCU,IAApC,CADnB;EAELG,IAAAA,CAAC,EAAED,qBAAqB,CAACL,QAAQ,CAACM,CAAV,EAAaZ,MAAb,EAAqBQ,QAAQ,CAACR,MAA9B,EAAsCS,IAAtC;EAFnB,GAAP;EAID;;EAED,SAASE,qBAAT,CACEL,QADF,EAEEC,SAFF,EAGEC,QAHF,EAIEC,IAJF;EAME,MAAMI,WAAW,GAAIN,SAAS,GAAGE,IAAb,GAAqB,CAArB,GAAyBD,QAAQ,GAAG,CAAxD;EACA,SAAON,IAAI,CAACC,GAAL,CAASU,WAAT,EAAsBX,IAAI,CAACY,GAAL,CAASR,QAAT,EAAmB,CAACO,WAApB,CAAtB,CAAP;EACD;;WAEeE,yBAAyBC,QAAeC;EACtD,SAAOf,IAAI,CAACgB,IAAL,CAAUhB,IAAI,CAACiB,GAAL,CAASH,MAAM,CAACJ,CAAP,GAAWK,MAAM,CAACL,CAA3B,EAA8B,CAA9B,IAAmCV,IAAI,CAACiB,GAAL,CAASH,MAAM,CAACN,CAAP,GAAWO,MAAM,CAACP,CAA3B,EAA8B,CAA9B,CAA7C,CAAP;EACD;WAEeU,yBAAyBJ,QAAeC;EACtD,SAAQf,IAAI,CAACmB,KAAL,CAAWJ,MAAM,CAACL,CAAP,GAAWI,MAAM,CAACJ,CAA7B,EAAgCK,MAAM,CAACP,CAAP,GAAWM,MAAM,CAACN,CAAlD,IAAuD,GAAxD,GAA+DR,IAAI,CAACoB,EAA3E;EACD;EAED;;;;;WAIgBC,mBACdC,MACAjB,WACAC,UACAb,QACAc,MACAb,UACAS;EADA,yBAAA,EAAA;EAAAT,IAAAA,YAAA;;;EACA,iCAAA,EAAA;EAAAS,IAAAA,uBAAA;;EAGA;;;EACA,MAAMoB,WAAW,GAAGpB,gBAAgB,IAAIT,QAAQ,KAAK,CAAjC,GAAqC8B,SAArC,GAAiDC,IAArE;EACA,MAAMC,sBAAsB,GAAG;EAC7BlB,IAAAA,CAAC,EAAEe,WAAW,CACZ,GADY,EAEX,CAAC,CAAClB,SAAS,CAACR,KAAV,GAAkBS,QAAQ,CAACT,KAAT,GAAiBU,IAApC,IAA4C,CAA5C,GAAgDe,IAAI,CAACd,CAAL,GAASD,IAA1D,IAAkEF,SAAS,CAACR,KAA7E,GAAsF,GAF1E,CADe;EAK7Ba,IAAAA,CAAC,EAAEa,WAAW,CACZ,GADY,EAEX,CAAC,CAAClB,SAAS,CAACP,MAAV,GAAmBQ,QAAQ,CAACR,MAAT,GAAkBS,IAAtC,IAA8C,CAA9C,GAAkDe,IAAI,CAACZ,CAAL,GAASH,IAA5D,IAAoEF,SAAS,CAACP,MAA/E,GAAyF,GAF7E,CALe;EAS7BD,IAAAA,KAAK,EAAE0B,WAAW,CAAC,GAAD,EAAQjB,QAAQ,CAACT,KAAT,GAAiBQ,SAAS,CAACR,KAA5B,GAAqC,GAAtC,GAA6CU,IAAnD,CATW;EAU7BT,IAAAA,MAAM,EAAEyB,WAAW,CAAC,GAAD,EAAQjB,QAAQ,CAACR,MAAT,GAAkBO,SAAS,CAACP,MAA7B,GAAuC,GAAxC,GAA+CS,IAArD;EAVU,GAA/B;;EAcA,MAAMoB,aAAa,GAAG3B,IAAI,CAAC4B,KAAL,CACpBL,WAAW,CACTlB,SAAS,CAACwB,YADD,EAERH,sBAAsB,CAAC7B,KAAvB,GAA+BQ,SAAS,CAACwB,YAA1C,GAA0D,GAFjD,CADS,CAAtB;EAMA,MAAMC,cAAc,GAAG9B,IAAI,CAAC4B,KAAL,CACrBL,WAAW,CACTlB,SAAS,CAAC0B,aADD,EAERL,sBAAsB,CAAC5B,MAAvB,GAAgCO,SAAS,CAAC0B,aAA3C,GAA4D,GAFnD,CADU,CAAvB;EAMA,MAAMC,kBAAkB,GAAG3B,SAAS,CAACwB,YAAV,IAA0BxB,SAAS,CAAC0B,aAAV,GAA0BtC,MAA/E;EAGA;EACA;EACA;;EACA,MAAMwC,UAAU,GAAGD,kBAAkB,GACjC;EACEnC,IAAAA,KAAK,EAAEG,IAAI,CAAC4B,KAAL,CAAWE,cAAc,GAAGrC,MAA5B,CADT;EAEEK,IAAAA,MAAM,EAAEgC;EAFV,GADiC,GAKjC;EACEjC,IAAAA,KAAK,EAAE8B,aADT;EAEE7B,IAAAA,MAAM,EAAEE,IAAI,CAAC4B,KAAL,CAAWD,aAAa,GAAGlC,MAA3B;EAFV,GALJ;;EASA,MAAMyC,iBAAiB,qCAClBD;EACHzB,IAAAA,CAAC,EAAER,IAAI,CAAC4B,KAAL,CACDL,WAAW,CACTlB,SAAS,CAACwB,YAAV,GAAyBI,UAAU,CAACpC,KAD3B,EAER6B,sBAAsB,CAAClB,CAAvB,GAA2BH,SAAS,CAACwB,YAAtC,GAAsD,GAF7C,CADV;EAMHnB,IAAAA,CAAC,EAAEV,IAAI,CAAC4B,KAAL,CACDL,WAAW,CACTlB,SAAS,CAAC0B,aAAV,GAA0BE,UAAU,CAACnC,MAD5B,EAER4B,sBAAsB,CAAChB,CAAvB,GAA2BL,SAAS,CAAC0B,aAAtC,GAAuD,GAF9C,CADV;MARL;;EAeA,SAAO;EAAEL,IAAAA,sBAAsB,wBAAxB;EAA0BQ,IAAAA,iBAAiB;EAA3C,GAAP;EACD;EAED;;;;EAGA,SAASV,SAAT,CAAmBZ,GAAnB,EAAgCuB,KAAhC;EACE,SAAOnC,IAAI,CAACC,GAAL,CAASW,GAAT,EAAcZ,IAAI,CAACY,GAAL,CAAS,CAAT,EAAYuB,KAAZ,CAAd,CAAP;EACD;;EAED,SAASV,IAAT,CAAcW,IAAd,EAA4BD,KAA5B;EACE,SAAOA,KAAP;EACD;EAED;;;;;EAGA,SAASE,4BAAT,CACEH,iBADF,EAEE7B,SAFF,EAGEC,QAHF;EAKE,MAAMgC,SAAS,GAAGjC,SAAS,CAACR,KAAV,GAAkBQ,SAAS,CAACwB,YAA9C;;EAEA,MAAIvB,QAAJ,EAAc;EACZ,QAAMiC,iBAAe,GAAGjC,QAAQ,CAACR,MAAT,GAAkBQ,QAAQ,CAACT,KAAnD;EACA,WAAO0C,iBAAe,GAClBjC,QAAQ,CAACR,MAAT,GAAkBwC,SAAlB,GAA8BJ,iBAAiB,CAACpC,MAD9B,GAElBQ,QAAQ,CAACT,KAAT,GAAiByC,SAAjB,GAA6BJ,iBAAiB,CAACrC,KAFnD;EAGD;;EAED,MAAMJ,MAAM,GAAGyC,iBAAiB,CAACrC,KAAlB,GAA0BqC,iBAAiB,CAACpC,MAA3D;EACA,MAAM0C,eAAe,GAAGnC,SAAS,CAACwB,YAAV,IAA0BxB,SAAS,CAAC0B,aAAV,GAA0BtC,MAA5E;EACA,SAAO+C,eAAe,GAClBnC,SAAS,CAAC0B,aAAV,GAA0BG,iBAAiB,CAACpC,MAD1B,GAElBO,SAAS,CAACwB,YAAV,GAAyBK,iBAAiB,CAACrC,KAF/C;EAGD;EAED;;;;;WAGgB4C,oCACdP,mBACA7B,WACAC;EAEA,MAAMgC,SAAS,GAAGjC,SAAS,CAACR,KAAV,GAAkBQ,SAAS,CAACwB,YAA9C;EAEA,MAAMtB,IAAI,GAAG8B,4BAA4B,CAACH,iBAAD,EAAoB7B,SAApB,EAA+BC,QAA/B,CAAzC;EAEA,MAAMoC,QAAQ,GAAGJ,SAAS,GAAG/B,IAA7B;EAEA,MAAMe,IAAI,GAAG;EACXd,IAAAA,CAAC,EAAE,CAAC,CAACH,SAAS,CAACwB,YAAV,GAAyBK,iBAAiB,CAACrC,KAA5C,IAAqD,CAArD,GAAyDqC,iBAAiB,CAAC1B,CAA5E,IAAiFkC,QADzE;EAEXhC,IAAAA,CAAC,EAAE,CAAC,CAACL,SAAS,CAAC0B,aAAV,GAA0BG,iBAAiB,CAACpC,MAA7C,IAAuD,CAAvD,GAA2DoC,iBAAiB,CAACxB,CAA9E,IAAmFgC;EAF3E,GAAb;EAIA,SAAO;EAAEpB,IAAAA,IAAI,MAAN;EAAQf,IAAAA,IAAI;EAAZ,GAAP;EACD;EAED;;;;WAGgBoC,UAAUC,GAAUC;EAClC,SAAO;EACLrC,IAAAA,CAAC,EAAE,CAACqC,CAAC,CAACrC,CAAF,GAAMoC,CAAC,CAACpC,CAAT,IAAc,CADZ;EAELE,IAAAA,CAAC,EAAE,CAACmC,CAAC,CAACnC,CAAF,GAAMkC,CAAC,CAAClC,CAAT,IAAc;EAFZ,GAAP;EAID;EAED;;;;;WAIgBoC,qBACdtC,GACAE,GACAqC,MACAC,MACAC;EAEA,MAAMC,GAAG,GAAGlD,IAAI,CAACkD,GAAjB;EACA,MAAMC,GAAG,GAAGnD,IAAI,CAACmD,GAAjB;EACA,MAAMC,MAAM,GAAIH,OAAO,GAAGjD,IAAI,CAACoB,EAAhB,GAAsB,GAArC;EACA;EACA;;EACA,MAAMiC,EAAE,GAAG,CAAC7C,CAAC,GAAGuC,IAAL,IAAaG,GAAG,CAACE,MAAD,CAAhB,GAA2B,CAAC1C,CAAC,GAAGsC,IAAL,IAAaG,GAAG,CAACC,MAAD,CAA3C,GAAsDL,IAAjE;EACA,MAAMO,EAAE,GAAG,CAAC9C,CAAC,GAAGuC,IAAL,IAAaI,GAAG,CAACC,MAAD,CAAhB,GAA2B,CAAC1C,CAAC,GAAGsC,IAAL,IAAaE,GAAG,CAACE,MAAD,CAA3C,GAAsDJ,IAAjE;EAEA,SAAO,CAACK,EAAD,EAAKC,EAAL,CAAP;EACD;EAED;;;;WAGgB1D,cAAcC,OAAeC,QAAgBJ;EAC3D,MAAM6D,OAAO,GAAG1D,KAAK,GAAG,CAAxB;EACA,MAAM2D,OAAO,GAAG1D,MAAM,GAAG,CAAzB;EAEA,MAAM2D,WAAW,GAAG,CAClBX,oBAAoB,CAAC,CAAD,EAAI,CAAJ,EAAOS,OAAP,EAAgBC,OAAhB,EAAyB9D,QAAzB,CADF,EAElBoD,oBAAoB,CAACjD,KAAD,EAAQ,CAAR,EAAW0D,OAAX,EAAoBC,OAApB,EAA6B9D,QAA7B,CAFF,EAGlBoD,oBAAoB,CAACjD,KAAD,EAAQC,MAAR,EAAgByD,OAAhB,EAAyBC,OAAzB,EAAkC9D,QAAlC,CAHF,EAIlBoD,oBAAoB,CAAC,CAAD,EAAIhD,MAAJ,EAAYyD,OAAZ,EAAqBC,OAArB,EAA8B9D,QAA9B,CAJF,CAApB;EAOA,MAAMgE,IAAI,GAAG1D,IAAI,CAACC,GAAL,MAAA,CAAAD,IAAA,EAAYyD,WAAW,CAACE,GAAZ,CAAgB,UAAAC,CAAA;EAAK,WAAAA,CAAC,CAAC,CAAD,CAAD;EAAI,GAAzB,CAAZ,CAAb;EACA,MAAMC,IAAI,GAAG7D,IAAI,CAACY,GAAL,MAAA,CAAAZ,IAAA,EAAYyD,WAAW,CAACE,GAAZ,CAAgB,UAAAC,CAAA;EAAK,WAAAA,CAAC,CAAC,CAAD,CAAD;EAAI,GAAzB,CAAZ,CAAb;EACA,MAAME,IAAI,GAAG9D,IAAI,CAACC,GAAL,MAAA,CAAAD,IAAA,EAAYyD,WAAW,CAACE,GAAZ,CAAgB,UAAAC,CAAA;EAAK,WAAAA,CAAC,CAAC,CAAD,CAAD;EAAI,GAAzB,CAAZ,CAAb;EACA,MAAMG,IAAI,GAAG/D,IAAI,CAACY,GAAL,MAAA,CAAAZ,IAAA,EAAYyD,WAAW,CAACE,GAAZ,CAAgB,UAAAC,CAAA;EAAK,WAAAA,CAAC,CAAC,CAAD,CAAD;EAAI,GAAzB,CAAZ,CAAb;EAEA,SAAO;EAAE/D,IAAAA,KAAK,EAAEgE,IAAI,GAAGH,IAAhB;EAAsB5D,IAAAA,MAAM,EAAEiE,IAAI,GAAGD;EAArC,GAAP;EACD;EAED;;;;WAGgBE;EAAW,eAAA;;SAAA,YAAAC,uBAAAA;EAAAC,IAAAA,QAAA,gBAAA;;;EACzB,SAAOA,IAAI,CACRC,MADI,CACG,UAAAhC,KAAA;EACN,QAAI,OAAOA,KAAP,KAAiB,QAAjB,IAA6BA,KAAK,CAACiC,MAAN,GAAe,CAAhD,EAAmD;EACjD,aAAO,IAAP;EACD;;EAED,WAAO,KAAP;EACD,GAPI,EAQJC,IARI,CAQC,GARD,EASJC,IATI,EAAP;EAUD;;;;EC9MD,IAAMC,QAAQ,GAAG,CAAjB;EACA,IAAMC,QAAQ,GAAG,CAAjB;;;;;EAEsBC,EAAAA,gCAAA;;EAAtB,kBAAA;EAAA,wEAAA;;EAiBEC,IAAAA,cAAA,GAAoC,IAApC;EACAA,IAAAA,cAAA,GAAoC,IAApC;EACAA,IAAAA,kBAAA,GAAsC,IAAtC;EACAA,IAAAA,cAAA,GAAoC,IAApC;EACAA,IAAAA,mBAAA,GAAgC,IAAhC;EACAA,IAAAA,eAAA,GAAuB;EAAE7E,MAAAA,KAAK,EAAE,CAAT;EAAYC,MAAAA,MAAM,EAAE,CAApB;EAAuB+B,MAAAA,YAAY,EAAE,CAArC;EAAwCE,MAAAA,aAAa,EAAE;EAAvD,KAAvB;EACA2C,IAAAA,uBAAA,GAA2B;EAAElE,MAAAA,CAAC,EAAE,CAAL;EAAQE,MAAAA,CAAC,EAAE;EAAX,KAA3B;EACAgE,IAAAA,mBAAA,GAAuB;EAAElE,MAAAA,CAAC,EAAE,CAAL;EAAQE,MAAAA,CAAC,EAAE;EAAX,KAAvB;EACAgE,IAAAA,uBAAA,GAAoB,CAApB;EACAA,IAAAA,uBAAA,GAAoB,CAApB;EACAA,IAAAA,oBAAA,GAAgC,IAAhC;EACAA,IAAAA,qBAAA,GAAiC,IAAjC;EACAA,IAAAA,gBAAA,GAA4B,IAA5B;EAEAA,IAAAA,WAAA,GAAe;EACbpE,MAAAA,QAAQ,EAAE,IADG;EAEbqE,MAAAA,mBAAmB,EAAE;EAFR,KAAf;;EAqEAD,IAAAA,uBAAA,GAAoB,UAACE,CAAD;EAAc,aAAAA,CAAC,CAACC,cAAF,EAAA;EAAkB,KAApD;;EAEAH,IAAAA,iBAAA,GAAc;EACZI,MAAAA,QAAQ,CAACC,mBAAT,CAA6B,WAA7B,EAA0CL,KAAI,CAACM,WAA/C;EACAF,MAAAA,QAAQ,CAACC,mBAAT,CAA6B,SAA7B,EAAwCL,KAAI,CAACO,aAA7C;EACAH,MAAAA,QAAQ,CAACC,mBAAT,CAA6B,WAA7B,EAA0CL,KAAI,CAACQ,WAA/C;EACAJ,MAAAA,QAAQ,CAACC,mBAAT,CAA6B,UAA7B,EAAyCL,KAAI,CAACO,aAA9C;EACD,KALD;;EAOAP,IAAAA,sBAAA,GAAmB;EACjB,UAAIA,KAAI,CAACS,YAAT,EAAuBT,KAAI,CAACS,YAAL,CAAkBJ,mBAAlB,CAAsC,OAAtC,EAA+CL,KAAI,CAACU,OAApD;;EACvB,UAAIV,KAAI,CAACW,UAAT,EAAqB;EACnBC,QAAAA,YAAY,CAACZ,KAAI,CAACW,UAAN,CAAZ;EACD;EACF,KALD;;EAOAX,IAAAA,iBAAA,GAAc;EACZA,MAAAA,KAAI,CAACa,YAAL;;EACAb,MAAAA,KAAI,CAACc,YAAL;;EACAd,MAAAA,KAAI,CAACe,cAAL;;EAEA,UAAIf,KAAI,CAACgB,KAAL,CAAWC,aAAf,EAA8B;EAC5BjB,QAAAA,KAAI,CAACgB,KAAL,CAAWC,aAAX,CAAyBjB,KAAI,CAACrE,SAA9B;EACD;EACF,KARD;;EAUAqE,IAAAA,oBAAA,GAAiB;EACT,UAAA/E,KAAyC+E,KAAI,CAACgB,KAA9C;EAAA,UAAEE,wBAAwB,8BAA1B;EAAA,UAA4BtF,QAAQ,cAApC;;EAEN,UAAI,CAACsF,wBAAL,EAA+B;EAC7B;EACD;;EAEK,UAAAC,KAAiBpD,mCAAmC,CACxDmD,wBADwD,EAExDlB,KAAI,CAACrE,SAFmD,EAGxDC,QAHwD,CAApD;EAAA,UAAEgB,IAAI,UAAN;EAAA,UAAQf,IAAI,UAAZ;;EAKNmE,MAAAA,KAAI,CAACgB,KAAL,CAAWI,YAAX,CAAwBxE,IAAxB;;EACAoD,MAAAA,KAAI,CAACgB,KAAL,CAAWK,YAAX,IAA2BrB,KAAI,CAACgB,KAAL,CAAWK,YAAX,CAAwBxF,IAAxB,CAA3B;EACD,KAdD;;EAwBAmE,IAAAA,kBAAA,GAAe;;;EACb,UAAMsB,QAAQ,GAAGtB,KAAI,CAACuB,QAAL,IAAiBvB,KAAI,CAACwB,QAAvC;;EACA,UAAIF,QAAQ,IAAItB,KAAI,CAACS,YAArB,EAAmC;EACjCT,QAAAA,KAAI,CAACyB,aAAL,GAAqBzB,KAAI,CAACS,YAAL,CAAkBiB,qBAAlB,EAArB;EAEA1B,QAAAA,KAAI,CAACrE,SAAL,GAAiB;EACfR,UAAAA,KAAK,EAAEmG,QAAQ,CAACK,WADD;EAEfvG,UAAAA,MAAM,EAAEkG,QAAQ,CAACM,YAFF;EAGfzE,UAAAA,YAAY,EAAE,OAAA6C,KAAI,CAACuB,kDAAUpE,YAAf,YAA+B6C,KAAI,CAACwB,kDAAUK,UAA9C,KAA4D,CAH3D;EAIfxE,UAAAA,aAAa,EAAE,OAAA2C,KAAI,CAACuB,kDAAUlE,aAAf,YAAgC2C,KAAI,CAACwB,kDAAUM,WAA/C,KAA8D;EAJ9D,SAAjB;EAMA,YAAMlG,QAAQ,GAAGoE,KAAI,CAACgB,KAAL,CAAWpF,QAAX,GACboE,KAAI,CAACgB,KAAL,CAAWpF,QADE,GAEblB,WAAW,CACT4G,QAAQ,CAACK,WADA,EAETL,QAAQ,CAACM,YAFA,EAGT5B,KAAI,CAACyB,aAAL,CAAmBtG,KAHV,EAIT6E,KAAI,CAACyB,aAAL,CAAmBrG,MAJV,EAKT4E,KAAI,CAACgB,KAAL,CAAWjG,MALF,EAMTiF,KAAI,CAACgB,KAAL,CAAWhG,QANF,CAFf;;EAWA,YACE,OAAAgF,KAAI,CAAC+B,KAAL,CAAWnG,kDAAUR,MAArB,MAAgCQ,QAAQ,CAACR,MAAzC,IACA,OAAA4E,KAAI,CAAC+B,KAAL,CAAWnG,kDAAUT,KAArB,MAA+BS,QAAQ,CAACT,KAF1C,EAGE;EACA6E,UAAAA,KAAI,CAACgB,KAAL,CAAWgB,gBAAX,IAA+BhC,KAAI,CAACgB,KAAL,CAAWgB,gBAAX,CAA4BpG,QAA5B,CAA/B;EACD;;EACDoE,QAAAA,KAAI,CAACiC,QAAL,CAAc;EAAErG,UAAAA,QAAQ;EAAV,SAAd,EAA4BoE,KAAI,CAACkC,qBAAjC;EACD;EACF,KA9BD;;EA0CAlC,IAAAA,iBAAA,GAAc,UAACE,CAAD;EACZA,MAAAA,CAAC,CAACC,cAAF;EACAC,MAAAA,QAAQ,CAAC+B,gBAAT,CAA0B,WAA1B,EAAuCnC,KAAI,CAACM,WAA5C;EACAF,MAAAA,QAAQ,CAAC+B,gBAAT,CAA0B,SAA1B,EAAqCnC,KAAI,CAACO,aAA1C;;EACAP,MAAAA,KAAI,CAACoC,WAAL,CAAiBC,OAAO,CAACC,aAAR,CAAsBpC,CAAtB,CAAjB;EACD,KALD;;EAOAF,IAAAA,iBAAA,GAAc,UAACE,CAAD;EAAmB,aAAAF,KAAI,CAACuC,MAAL,CAAYF,OAAO,CAACC,aAAR,CAAsBpC,CAAtB,CAAZ,CAAA;EAAqC,KAAtE;;EAEAF,IAAAA,kBAAA,GAAe,UAACE,CAAD;EACbA,MAAAA,CAAC,CAACC,cAAF;EACAC,MAAAA,QAAQ,CAAC+B,gBAAT,CAA0B,WAA1B,EAAuCnC,KAAI,CAACQ,WAA5C,EAAyD;EAAEgC,QAAAA,OAAO,EAAE;EAAX,OAAzD;;EACApC,MAAAA,QAAQ,CAAC+B,gBAAT,CAA0B,UAA1B,EAAsCnC,KAAI,CAACO,aAA3C;;EACA,UAAIL,CAAC,CAACuC,OAAF,CAAU/C,MAAV,KAAqB,CAAzB,EAA4B;EAC1BM,QAAAA,KAAI,CAAC0C,YAAL,CAAkBxC,CAAlB;EACD,OAFD,MAEO,IAAIA,CAAC,CAACuC,OAAF,CAAU/C,MAAV,KAAqB,CAAzB,EAA4B;EACjCM,QAAAA,KAAI,CAACoC,WAAL,CAAiBC,OAAO,CAACM,aAAR,CAAsBzC,CAAC,CAACuC,OAAF,CAAU,CAAV,CAAtB,CAAjB;EACD;EACF,KATD;;EAWAzC,IAAAA,iBAAA,GAAc,UAACE,CAAD;EACZ;EACAA,MAAAA,CAAC,CAACC,cAAF;;EACA,UAAID,CAAC,CAACuC,OAAF,CAAU/C,MAAV,KAAqB,CAAzB,EAA4B;EAC1BM,QAAAA,KAAI,CAAC4C,WAAL,CAAiB1C,CAAjB;EACD,OAFD,MAEO,IAAIA,CAAC,CAACuC,OAAF,CAAU/C,MAAV,KAAqB,CAAzB,EAA4B;EACjCM,QAAAA,KAAI,CAACuC,MAAL,CAAYF,OAAO,CAACM,aAAR,CAAsBzC,CAAC,CAACuC,OAAF,CAAU,CAAV,CAAtB,CAAZ;EACD;EACF,KARD;;EAUAzC,IAAAA,iBAAA,GAAc,UAAC/E,EAAD;;;YAAGa,CAAC;YAAEE,CAAC;EACnBgE,MAAAA,KAAI,CAAC6C,iBAAL,GAAyB;EAAE/G,QAAAA,CAAC,GAAH;EAAKE,QAAAA,CAAC;EAAN,OAAzB;EACAgE,MAAAA,KAAI,CAAC8C,aAAL,sBAA0B9C,KAAI,CAACgB,KAAL,CAAWpE,KAArC;EACA,YAAA,MAAAoD,KAAI,CAACgB,KAAL,EAAW+B,kBAAX,UAAA,iBAAA,SAAA,cAAA;EACD,KAJD;;EAMA/C,IAAAA,YAAA,GAAS,UAAC/E,EAAD;YAAGa,CAAC;YAAEE,CAAC;EACd,UAAIgE,KAAI,CAACgD,cAAT,EAAyBC,MAAM,CAACC,oBAAP,CAA4BlD,KAAI,CAACgD,cAAjC;EAEzBhD,MAAAA,KAAI,CAACgD,cAAL,GAAsBC,MAAM,CAACE,qBAAP,CAA6B;EACjD,YAAI,CAACnD,KAAI,CAAC+B,KAAL,CAAWnG,QAAhB,EAA0B;EAC1B,YAAIE,CAAC,KAAKsH,SAAN,IAAmBpH,CAAC,KAAKoH,SAA7B,EAAwC;EACxC,YAAMC,OAAO,GAAGvH,CAAC,GAAGkE,KAAI,CAAC6C,iBAAL,CAAuB/G,CAA3C;EACA,YAAMwH,OAAO,GAAGtH,CAAC,GAAGgE,KAAI,CAAC6C,iBAAL,CAAuB7G,CAA3C;EACA,YAAMuH,iBAAiB,GAAG;EACxBzH,UAAAA,CAAC,EAAEkE,KAAI,CAAC8C,aAAL,CAAmBhH,CAAnB,GAAuBuH,OADF;EAExBrH,UAAAA,CAAC,EAAEgE,KAAI,CAAC8C,aAAL,CAAmB9G,CAAnB,GAAuBsH;EAFF,SAA1B;EAKA,YAAME,WAAW,GAAGxD,KAAI,CAACgB,KAAL,CAAWvF,gBAAX,GAChBA,gBAAgB,CACd8H,iBADc,EAEdvD,KAAI,CAACrE,SAFS,EAGdqE,KAAI,CAAC+B,KAAL,CAAWnG,QAHG,EAIdoE,KAAI,CAACgB,KAAL,CAAWnF,IAJG,EAKdmE,KAAI,CAACgB,KAAL,CAAWhG,QALG,CADA,GAQhBuI,iBARJ;;EASAvD,QAAAA,KAAI,CAACgB,KAAL,CAAWI,YAAX,CAAwBoC,WAAxB;EACD,OApBqB,CAAtB;EAqBD,KAxBD;;EA0BAxD,IAAAA,mBAAA,GAAgB;;;EACdA,MAAAA,KAAI,CAACyD,WAAL;;EACAzD,MAAAA,KAAI,CAACc,YAAL;;EACA,YAAA,MAAAd,KAAI,CAACgB,KAAL,EAAW0C,gBAAX,UAAA,iBAAA,SAAA,cAAA;EACD,KAJD;;EAkCA1D,IAAAA,aAAA,GAAU,UAACE,CAAD;EACRA,MAAAA,CAAC,CAACC,cAAF;EACA,UAAMwD,KAAK,GAAGtB,OAAO,CAACC,aAAR,CAAsBpC,CAAtB,CAAd;EACQ,UAAA0D,MAAM,GAAKC,kCAAc,CAAC3D,CAAD,CAAd,OAAX;EACR,UAAM4D,OAAO,GAAG9D,KAAI,CAACgB,KAAL,CAAWnF,IAAX,GAAmB+H,MAAM,GAAG5D,KAAI,CAACgB,KAAL,CAAW+C,SAArB,GAAkC,GAApE;;EACA/D,MAAAA,KAAI,CAACgE,UAAL,CAAgBF,OAAhB,EAAyBH,KAAzB;;EAEA,UAAI,CAAC3D,KAAI,CAAC+B,KAAL,CAAW9B,mBAAhB,EAAqC;EACnCD,QAAAA,KAAI,CAACiC,QAAL,CAAc;EAAEhC,UAAAA,mBAAmB,EAAE;EAAvB,SAAd,EAA6C;;;yBAAM,MAAAD,KAAI,CAACgB,KAAL,EAAW+B;EAAsB,SAApF;EACD;;EAED,UAAI/C,KAAI,CAACW,UAAT,EAAqB;EACnBC,QAAAA,YAAY,CAACZ,KAAI,CAACW,UAAN,CAAZ;EACD;;EACDX,MAAAA,KAAI,CAACW,UAAL,GAAkBsC,MAAM,CAACgB,UAAP,CAChB;EAAM,eAAAjE,KAAI,CAACiC,QAAL,CAAc;EAAEhC,UAAAA,mBAAmB,EAAE;EAAvB,SAAd,EAA8C;;;yBAAM,MAAAD,KAAI,CAACgB,KAAL,EAAW0C;EAAoB,SAAnF,CAAA;EAAoF,OAD1E,EAEhB,GAFgB,CAAlB;EAID,KAlBD;;EAoBA1D,IAAAA,yBAAA,GAAsB,UAAC/E,EAAD;YAAGa,CAAC;YAAEE,CAAC;;EAC3B,UAAI,CAACgE,KAAI,CAACyB,aAAV,EAAyB;EACvB,cAAM,IAAIyC,KAAJ,CAAU,4BAAV,CAAN;EACD;;EACD,aAAO;EACLpI,QAAAA,CAAC,EAAEkE,KAAI,CAACyB,aAAL,CAAmBtG,KAAnB,GAA2B,CAA3B,IAAgCW,CAAC,GAAGkE,KAAI,CAACyB,aAAL,CAAmB0C,IAAvD,CADE;EAELnI,QAAAA,CAAC,EAAEgE,KAAI,CAACyB,aAAL,CAAmBrG,MAAnB,GAA4B,CAA5B,IAAiCY,CAAC,GAAGgE,KAAI,CAACyB,aAAL,CAAmB2C,GAAxD;EAFE,OAAP;EAID,KARD;;EAUApE,IAAAA,qBAAA,GAAkB,UAAC/E,EAAD;YAAGa,CAAC;YAAEE,CAAC;EACjB,UAAAmF,KAAiBnB,KAAI,CAACgB,KAAtB;EAAA,UAAEpE,IAAI,UAAN;EAAA,UAAQf,IAAI,UAAZ;EACN,aAAO;EACLC,QAAAA,CAAC,EAAE,CAACA,CAAC,GAAGc,IAAI,CAACd,CAAV,IAAeD,IADb;EAELG,QAAAA,CAAC,EAAE,CAACA,CAAC,GAAGY,IAAI,CAACZ,CAAV,IAAeH;EAFb,OAAP;EAID,KAND;;EAQAmE,IAAAA,gBAAA,GAAa,UAACnE,IAAD,EAAe8H,KAAf;EACX,UAAI,CAAC3D,KAAI,CAAC+B,KAAL,CAAWnG,QAAZ,IAAwB,CAACoE,KAAI,CAACgB,KAAL,CAAWK,YAAxC,EAAsD;;EAEtD,UAAMgD,SAAS,GAAGrE,KAAI,CAACsE,mBAAL,CAAyBX,KAAzB,CAAlB;;EACA,UAAMY,UAAU,GAAGvE,KAAI,CAACwE,eAAL,CAAqBH,SAArB,CAAnB;;EACA,UAAMP,OAAO,GAAGxI,IAAI,CAACC,GAAL,CAASyE,KAAI,CAACgB,KAAL,CAAWyD,OAApB,EAA6BnJ,IAAI,CAACY,GAAL,CAASL,IAAT,EAAemE,KAAI,CAACgB,KAAL,CAAW0D,OAA1B,CAA7B,CAAhB;EACA,UAAMnB,iBAAiB,GAAG;EACxBzH,QAAAA,CAAC,EAAEyI,UAAU,CAACzI,CAAX,GAAegI,OAAf,GAAyBO,SAAS,CAACvI,CADd;EAExBE,QAAAA,CAAC,EAAEuI,UAAU,CAACvI,CAAX,GAAe8H,OAAf,GAAyBO,SAAS,CAACrI;EAFd,OAA1B;EAIA,UAAMwH,WAAW,GAAGxD,KAAI,CAACgB,KAAL,CAAWvF,gBAAX,GAChBA,gBAAgB,CACd8H,iBADc,EAEdvD,KAAI,CAACrE,SAFS,EAGdqE,KAAI,CAAC+B,KAAL,CAAWnG,QAHG,EAIdkI,OAJc,EAKd9D,KAAI,CAACgB,KAAL,CAAWhG,QALG,CADA,GAQhBuI,iBARJ;;EAUAvD,MAAAA,KAAI,CAACgB,KAAL,CAAWI,YAAX,CAAwBoC,WAAxB;;EACAxD,MAAAA,KAAI,CAACgB,KAAL,CAAWK,YAAX,CAAwByC,OAAxB;EACD,KAtBD;;EAwBA9D,IAAAA,iBAAA,GAAc;EACZ,UAAI,CAACA,KAAI,CAAC+B,KAAL,CAAWnG,QAAhB,EAA0B;EACxB,eAAO,IAAP;EACD;;;EAGD,UAAM+I,kBAAkB,GAAG3E,KAAI,CAACgB,KAAL,CAAWvF,gBAAX,GACvBA,gBAAgB,CACduE,KAAI,CAACgB,KAAL,CAAWpE,IADG,EAEdoD,KAAI,CAACrE,SAFS,EAGdqE,KAAI,CAAC+B,KAAL,CAAWnG,QAHG,EAIdoE,KAAI,CAACgB,KAAL,CAAWnF,IAJG,EAKdmE,KAAI,CAACgB,KAAL,CAAWhG,QALG,CADO,GAQvBgF,KAAI,CAACgB,KAAL,CAAWpE,IARf;EASA,aAAOD,kBAAkB,CACvBgI,kBADuB,EAEvB3E,KAAI,CAACrE,SAFkB,EAGvBqE,KAAI,CAAC+B,KAAL,CAAWnG,QAHY,EAIvBoE,KAAI,CAAC4E,SAAL,EAJuB,EAKvB5E,KAAI,CAACgB,KAAL,CAAWnF,IALY,EAMvBmE,KAAI,CAACgB,KAAL,CAAWhG,QANY,EAOvBgF,KAAI,CAACgB,KAAL,CAAWvF,gBAPY,CAAzB;EASD,KAxBD;;EA0BAuE,IAAAA,kBAAA,GAAe;EACb,UAAM6E,QAAQ,GAAG7E,KAAI,CAAC8E,WAAL,EAAjB;;EACA,UAAI,CAACD,QAAL,EAAe;EAEP,UAAA7H,sBAAsB,GAAwB6H,QAAQ,uBAAtD;EAAA,UAAwBrH,iBAAiB,GAAKqH,QAAQ,kBAAtD;;EACR,UAAI7E,KAAI,CAACgB,KAAL,CAAW+D,cAAf,EAA+B;EAC7B/E,QAAAA,KAAI,CAACgB,KAAL,CAAW+D,cAAX,CAA0B/H,sBAA1B,EAAkDQ,iBAAlD;EACD;;EAED,UAAIwC,KAAI,CAACgB,KAAL,CAAWgE,gBAAf,EAAiC;EAC/BhF,QAAAA,KAAI,CAACgB,KAAL,CAAWgE,gBAAX,CAA4BhI,sBAA5B,EAAoDQ,iBAApD;EACD;EACF,KAZD;;EAcAwC,IAAAA,wBAAA,GAAqB;EACnB,UAAM6E,QAAQ,GAAG7E,KAAI,CAAC8E,WAAL,EAAjB;;EACA,UAAI,CAACD,QAAL,EAAe;EAEP,UAAA7H,sBAAsB,GAAwB6H,QAAQ,uBAAtD;EAAA,UAAwBrH,iBAAiB,GAAKqH,QAAQ,kBAAtD;;EACR,UAAI7E,KAAI,CAACgB,KAAL,CAAWgE,gBAAf,EAAiC;EAC/BhF,QAAAA,KAAI,CAACgB,KAAL,CAAWgE,gBAAX,CAA4BhI,sBAA5B,EAAoDQ,iBAApD;EACD;EACF,KARD;;EAUAwC,IAAAA,2BAAA,GAAwB;EACtB,UAAI,CAACA,KAAI,CAAC+B,KAAL,CAAWnG,QAAhB,EAA0B;EAE1B,UAAM4H,WAAW,GAAGxD,KAAI,CAACgB,KAAL,CAAWvF,gBAAX,GAChBA,gBAAgB,CACduE,KAAI,CAACgB,KAAL,CAAWpE,IADG,EAEdoD,KAAI,CAACrE,SAFS,EAGdqE,KAAI,CAAC+B,KAAL,CAAWnG,QAHG,EAIdoE,KAAI,CAACgB,KAAL,CAAWnF,IAJG,EAKdmE,KAAI,CAACgB,KAAL,CAAWhG,QALG,CADA,GAQhBgF,KAAI,CAACgB,KAAL,CAAWpE,IARf;;EASAoD,MAAAA,KAAI,CAACgB,KAAL,CAAWI,YAAX,CAAwBoC,WAAxB;;EACAxD,MAAAA,KAAI,CAACc,YAAL;EACD,KAdD;;;EA6FD;;EAzcCuB,EAAAA,iBAAA,kBAAA,GAAA;EACEY,IAAAA,MAAM,CAACd,gBAAP,CAAwB,QAAxB,EAAkC,KAAKtB,YAAvC;;EACA,QAAI,KAAKJ,YAAT,EAAuB;EACrB,WAAKO,KAAL,CAAWiE,cAAX,IACE,KAAKxE,YAAL,CAAkB0B,gBAAlB,CAAmC,OAAnC,EAA4C,KAAKzB,OAAjD,EAA0D;EAAE8B,QAAAA,OAAO,EAAE;EAAX,OAA1D,CADF;EAEA,WAAK/B,YAAL,CAAkB0B,gBAAlB,CAAmC,cAAnC,EAAmD,KAAK+C,iBAAxD;EACA,WAAKzE,YAAL,CAAkB0B,gBAAlB,CAAmC,eAAnC,EAAoD,KAAK+C,iBAAzD;EACD;;EAED,QAAI,CAAC,KAAKlE,KAAL,CAAWmE,+BAAhB,EAAiD;EAC/C,WAAKC,QAAL,GAAgBhF,QAAQ,CAACiF,aAAT,CAAuB,OAAvB,CAAhB;EACA,WAAKD,QAAL,CAAcE,YAAd,CAA2B,MAA3B,EAAmC,UAAnC;EACA,WAAKF,QAAL,CAAcG,SAAd,GAA0BC,QAA1B;EACApF,MAAAA,QAAQ,CAACqF,IAAT,CAAcC,WAAd,CAA0B,KAAKN,QAA/B;EACD;;;EAGD,QAAI,KAAK7D,QAAL,IAAiB,KAAKA,QAAL,CAAcoE,QAAnC,EAA6C;EAC3C,WAAKC,WAAL;EACD;EACF,GApBD;;EAsBAvD,EAAAA,iBAAA,qBAAA,GAAA;EACEY,IAAAA,MAAM,CAAC5C,mBAAP,CAA2B,QAA3B,EAAqC,KAAKQ,YAA1C;;EACA,QAAI,KAAKJ,YAAT,EAAuB;EACrB,WAAKA,YAAL,CAAkBJ,mBAAlB,CAAsC,cAAtC,EAAsD,KAAK6E,iBAA3D;EACA,WAAKzE,YAAL,CAAkBJ,mBAAlB,CAAsC,eAAtC,EAAuD,KAAK6E,iBAA5D;EACD;;EAED,QAAI,KAAKE,QAAT,EAAmB;EACjB,WAAKA,QAAL,CAAcS,MAAd;EACD;;EAED,SAAKpC,WAAL;EACA,SAAKzC,KAAL,CAAWiE,cAAX,IAA6B,KAAKa,gBAAL,EAA7B;EACD,GAbD;;EAeAzD,EAAAA,iBAAA,mBAAA,GAAA,UAAmB0D,SAAnB;;;EACE,QAAIA,SAAS,CAAC/K,QAAV,KAAuB,KAAKgG,KAAL,CAAWhG,QAAtC,EAAgD;EAC9C,WAAK6F,YAAL;EACA,WAAKqB,qBAAL;EACD,KAHD,MAGO,IAAI6D,SAAS,CAAChL,MAAV,KAAqB,KAAKiG,KAAL,CAAWjG,MAApC,EAA4C;EACjD,WAAK8F,YAAL;EACD,KAFM,MAEA,IAAIkF,SAAS,CAAClK,IAAV,KAAmB,KAAKmF,KAAL,CAAWnF,IAAlC,EAAwC;EAC7C,WAAKqG,qBAAL;EACD,KAFM,MAEA,IACL,OAAA6D,SAAS,CAACnK,kDAAUR,MAApB,aAA+B,KAAK4F,KAAL,CAAWpF,kDAAUR,MAApD,KACA,OAAA2K,SAAS,CAACnK,kDAAUT,KAApB,aAA8B,KAAK6F,KAAL,CAAWpF,kDAAUT,KAAnD,CAFK,EAGL;EACA,WAAK0F,YAAL;EACD,KALM,MAKA,IACL,OAAAkF,SAAS,CAACnJ,8CAAMd,CAAhB,aAAsB,KAAKkF,KAAL,CAAWpE,8CAAMd,CAAvC,KACA,OAAAiK,SAAS,CAACnJ,8CAAMZ,CAAhB,aAAsB,KAAKgF,KAAL,CAAWpE,8CAAMZ,CAAvC,CAFK,EAGL;EACA,WAAKgK,kBAAL;EACD;;EACD,QAAID,SAAS,CAACd,cAAV,KAA6B,KAAKjE,KAAL,CAAWiE,cAAxC,IAA0D,KAAKxE,YAAnE,EAAiF;EAC/E,WAAKO,KAAL,CAAWiE,cAAX,GACI,KAAKxE,YAAL,CAAkB0B,gBAAlB,CAAmC,OAAnC,EAA4C,KAAKzB,OAAjD,EAA0D;EAAE8B,QAAAA,OAAO,EAAE;EAAX,OAA1D,CADJ,GAEI,KAAKsD,gBAAL,EAFJ;EAGD;EACF,GAxBD;;EAqEAzD,EAAAA,iBAAA,UAAA,GAAA;EACQ,QAAApH,KAAuB,KAAK+F,KAA5B;EAAA,QAAEpF,QAAQ,cAAV;EAAA,QAAYb,MAAM,YAAlB;;EACN,QAAIa,QAAJ,EAAc;EACZ,aAAOA,QAAQ,CAACT,KAAT,GAAiBS,QAAQ,CAACR,MAAjC;EACD;;EACD,WAAOL,MAAP;EACD,GAND;;EAsHAsH,EAAAA,iBAAA,aAAA,GAAA,UAAanC,CAAb;EACE,QAAM9D,MAAM,GAAGiG,OAAO,CAACM,aAAR,CAAsBzC,CAAC,CAACuC,OAAF,CAAU,CAAV,CAAtB,CAAf;EACA,QAAMpG,MAAM,GAAGgG,OAAO,CAACM,aAAR,CAAsBzC,CAAC,CAACuC,OAAF,CAAU,CAAV,CAAtB,CAAf;EACA,SAAKwD,iBAAL,GAAyB9J,wBAAwB,CAACC,MAAD,EAASC,MAAT,CAAjD;EACA,SAAK6J,iBAAL,GAAyB1J,wBAAwB,CAACJ,MAAD,EAASC,MAAT,CAAjD;EACA,SAAK+F,WAAL,CAAiBnE,SAAS,CAAC7B,MAAD,EAASC,MAAT,CAA1B;EACD,GAND;;EAQAgG,EAAAA,iBAAA,YAAA,GAAA,UAAYnC,CAAZ;EAAA,oBAAA;;EACE,QAAM9D,MAAM,GAAGiG,OAAO,CAACM,aAAR,CAAsBzC,CAAC,CAACuC,OAAF,CAAU,CAAV,CAAtB,CAAf;EACA,QAAMpG,MAAM,GAAGgG,OAAO,CAACM,aAAR,CAAsBzC,CAAC,CAACuC,OAAF,CAAU,CAAV,CAAtB,CAAf;EACA,QAAM0D,MAAM,GAAGlI,SAAS,CAAC7B,MAAD,EAASC,MAAT,CAAxB;EACA,SAAKkG,MAAL,CAAY4D,MAAZ;EAEA,QAAI,KAAKC,eAAT,EAA0BnD,MAAM,CAACC,oBAAP,CAA4B,KAAKkD,eAAjC;EAC1B,SAAKA,eAAL,GAAuBnD,MAAM,CAACE,qBAAP,CAA6B;EAClD,UAAMkD,QAAQ,GAAGlK,wBAAwB,CAACC,MAAD,EAASC,MAAT,CAAzC;EACA,UAAMyH,OAAO,GAAG9D,KAAI,CAACgB,KAAL,CAAWnF,IAAX,IAAmBwK,QAAQ,GAAGrG,KAAI,CAACiG,iBAAnC,CAAhB;;EACAjG,MAAAA,KAAI,CAACgE,UAAL,CAAgBF,OAAhB,EAAyBqC,MAAzB;;EACAnG,MAAAA,KAAI,CAACiG,iBAAL,GAAyBI,QAAzB;EAEA,UAAMrL,QAAQ,GAAGwB,wBAAwB,CAACJ,MAAD,EAASC,MAAT,CAAzC;EACA,UAAMiK,WAAW,GAAGtG,KAAI,CAACgB,KAAL,CAAWhG,QAAX,IAAuBA,QAAQ,GAAGgF,KAAI,CAACkG,iBAAvC,CAApB;EACAlG,MAAAA,KAAI,CAACgB,KAAL,CAAWuF,gBAAX,IAA+BvG,KAAI,CAACgB,KAAL,CAAWuF,gBAAX,CAA4BD,WAA5B,CAA/B;EACAtG,MAAAA,KAAI,CAACkG,iBAAL,GAAyBlL,QAAzB;EACD,KAVsB,CAAvB;EAWD,GAlBD;;EAoJAqH,EAAAA,iBAAA,OAAA,GAAA;EAAA,oBAAA;;EACQ,QAAApH,KAYF,KAAK+F,KAZH;EAAA,QACJwF,KAAK,WADD;EAAA,QAEJC,KAAK,WAFD;EAAA,QAGJC,UAAU,gBAHN;EAAA,QAIJC,SAAS,eAJL;EAAA,QAKJxF,YALI;EAAA,QAKIrF,CAAC,OALL;EAAA,QAKOE,CAAC,OALR;EAAA,QAMJhB,QAAQ,cANJ;EAAA,QAOJa,IAAI,UAPA;EAAA,QAQJ+K,SAAS,eARL;EAAA,QASJC,QAAQ,cATJ;EAAA,QAUJC,aAVI;EAAA,QAUKC,cAAc,oBAVnB;EAAA,QAUqBC,aAAa,mBAVlC;EAAA,QAUoCC,UAAU,gBAV9C;EAAA,QAWJC,eAXI;EAAA,QAWOC,kBAAkB,wBAXzB;EAAA,QAW2BC,iBAAiB,uBAX5C;EAAA,QAW8CC,cAAc,oBAX5D;EAcN,wBACEC,uCAAA,MAAA;EACEC,MAAAA,WAAW,EAAE,KAAKA;EAClBC,MAAAA,YAAY,EAAE,KAAKA;EACnBC,MAAAA,GAAG,EAAE,aAACC,EAAD;EAAQ,eAAC1H,KAAI,CAACS,YAAL,GAAoBiH,EAArB;EAAwB;uBACzB;EACZC,MAAAA,KAAK,EAAEZ;EACPa,MAAAA,SAAS,EAAEtI,UAAU,CAAC,yBAAD,EAA4B6H,kBAA5B;OANvB,EAQGX,KAAK,gBACJc,uCAAA,MAAA;EACEO,MAAAA,GAAG,EAAC;EACJD,MAAAA,SAAS,EAAEtI,UAAU,CAAC,qBAAD,EAAwB+H,cAAxB;SAChBX;EACLoB,MAAAA,GAAG,EAAEtB;EACLiB,MAAAA,GAAG,EAAE,aAACC,EAAD;EAA0B,eAAC1H,KAAI,CAACuB,QAAL,GAAgBmG,EAAjB;EAAoB;EACnDC,MAAAA,KAAK,oCACAV;EACHN,QAAAA,SAAS,EACPA,SAAS,IAAI,eAAa7K,CAAb,SAAA,GAAqBE,CAArB,gBAAA,GAAoChB,QAApC,gBAAA,GAA0Da,IAA1D;;EAEjBkM,MAAAA,MAAM,EAAE,KAAKnC;QAXf,CADI,GAeJa,KAAK,iBACHa,uCAAA,QAAA;EACEU,MAAAA,QAAQ;EACRC,MAAAA,IAAI;EACJC,MAAAA,KAAK,EAAE;EACPN,MAAAA,SAAS,EAAEtI,UAAU,CAAC,qBAAD,EAAwB+H,cAAxB;SACjBX;EACJoB,MAAAA,GAAG,EAAErB;EACLgB,MAAAA,GAAG,EAAE,aAACC,EAAD;EAA0B,eAAC1H,KAAI,CAACwB,QAAL,GAAgBkG,EAAjB;EAAoB;EACnDS,MAAAA,gBAAgB,EAAE,KAAKvC;EACvB+B,MAAAA,KAAK,oCACAV;EACHN,QAAAA,SAAS,EACPA,SAAS,IAAI,eAAa7K,CAAb,SAAA,GAAqBE,CAArB,gBAAA,GAAoChB,QAApC,gBAAA,GAA0Da,IAA1D;;EAEjBuM,MAAAA,QAAQ,EAAE;QAdZ,CAxBN,EA0CG,KAAKrG,KAAL,CAAWnG,QAAX,iBACC0L,uCAAA,MAAA;EACEK,MAAAA,KAAK,oCACAX;EACH7L,QAAAA,KAAK,EAAE,KAAK4G,KAAL,CAAWnG,QAAX,CAAoBT;EAC3BC,QAAAA,MAAM,EAAE,KAAK2G,KAAL,CAAWnG,QAAX,CAAoBR;;uBAElB;EACZwM,MAAAA,SAAS,EAAEtI,UAAU,CACnB,wBADmB,EAEnBsH,SAAS,KAAK,OAAd,IAAyB,6BAFN,EAGnBC,QAAQ,IAAI,4BAHO,EAInBO,iBAJmB;OAPvB,CA3CJ,CADF;EA6DD,GA5ED;;EA/ZO/E,EAAAA,oBAAA,GAAe;EACpBxG,IAAAA,IAAI,EAAE,CADc;EAEpBb,IAAAA,QAAQ,EAAE,CAFU;EAGpBD,IAAAA,MAAM,EAAE,IAAI,CAHQ;EAIpB0J,IAAAA,OAAO,EAAE3E,QAJW;EAKpB4E,IAAAA,OAAO,EAAE7E,QALW;EAMpB+G,IAAAA,SAAS,EAAE,MANS;EAOpBC,IAAAA,QAAQ,EAAE,IAPU;EAQpBc,IAAAA,KAAK,EAAE,EARa;EASpBU,IAAAA,OAAO,EAAE,EATW;EAUpB3B,IAAAA,UAAU,EAAE,EAVQ;EAWpB3C,IAAAA,SAAS,EAAE,CAXS;EAYpBtI,IAAAA,gBAAgB,EAAE,IAZE;EAapBwJ,IAAAA,cAAc,EAAE;EAbI,GAAf;;EAqLA5C,EAAAA,qBAAA,GAAgB,UAACnC,CAAD;EAAsC,WAAC;EAC5DpE,MAAAA,CAAC,EAAEwM,MAAM,CAACpI,CAAC,CAACqI,OAAH,CADmD;EAE5DvM,MAAAA,CAAC,EAAEsM,MAAM,CAACpI,CAAC,CAACsI,OAAH;EAFmD,KAAD;EAG3D,GAHK;;EAKAnG,EAAAA,qBAAA,GAAgB,UAACoG,KAAD;EAAgC,WAAC;EACtD3M,MAAAA,CAAC,EAAEwM,MAAM,CAACG,KAAK,CAACF,OAAP,CAD6C;EAEtDvM,MAAAA,CAAC,EAAEsM,MAAM,CAACG,KAAK,CAACD,OAAP;EAF6C,KAAD;EAGrD,GAHK;;EAkTT,gBAAA;EA7eA,EAAsBlB,yBAAK,CAACoB;;;;;;;;"}